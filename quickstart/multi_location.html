<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>阶段3 多地部署 | Bird Wiki</title><meta name="description" content="一篇关于bird的百科（或者手册）">
    <link rel="modulepreload" href="/assets/app.6747bec2.js"><link rel="modulepreload" href="/assets/multi_location.html.2811c5c7.js"><link rel="modulepreload" href="/assets/multi_location.html.f2588af9.js"><link rel="prefetch" href="/assets/index.html.c899f7c1.js"><link rel="prefetch" href="/assets/index.html.f6fa193b.js"><link rel="prefetch" href="/assets/index.html.59fe1616.js"><link rel="prefetch" href="/assets/after.html.0aed882b.js"><link rel="prefetch" href="/assets/before.html.7f9740b4.js"><link rel="prefetch" href="/assets/idc.html.1524ab3c.js"><link rel="prefetch" href="/assets/player.html.4fc3615f.js"><link rel="prefetch" href="/assets/index.html.9fa01890.js"><link rel="prefetch" href="/assets/index.html.6fa58f93.js"><link rel="prefetch" href="/assets/index.html.661864ac.js"><link rel="prefetch" href="/assets/404.html.d2dc3323.js"><link rel="prefetch" href="/assets/index.html.481e7143.js"><link rel="prefetch" href="/assets/index.html.dfa4ba4b.js"><link rel="prefetch" href="/assets/index.html.25f5b183.js"><link rel="prefetch" href="/assets/after.html.d5101399.js"><link rel="prefetch" href="/assets/before.html.90856bf8.js"><link rel="prefetch" href="/assets/idc.html.be8448a3.js"><link rel="prefetch" href="/assets/player.html.d6b7d025.js"><link rel="prefetch" href="/assets/index.html.30debefb.js"><link rel="prefetch" href="/assets/index.html.269ba93e.js"><link rel="prefetch" href="/assets/index.html.1c8fe48a.js"><link rel="prefetch" href="/assets/404.html.f7378eeb.js">
    <link rel="stylesheet" href="/assets/style.3db455f5.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">Bird Wiki</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/quickstart/" class="router-link-active" aria-label="快速开始"><!--[--><!--]--> 快速开始 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/quickstart/" class="router-link-active" aria-label="快速开始"><!--[--><!--]--> 快速开始 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/quickstart/" class="router-link-active sidebar-item sidebar-heading" aria-label="简介"><!--[--><!--]--> 简介 <!--[--><!--]--></a><!----></li><li><a href="/quickstart/before.html" class="sidebar-item sidebar-heading" aria-label="开始之前"><!--[--><!--]--> 开始之前 <!--[--><!--]--></a><!----></li><li><a href="/quickstart/player.html" class="sidebar-item sidebar-heading" aria-label="阶段1 BGP Player"><!--[--><!--]--> 阶段1 BGP Player <!--[--><!--]--></a><!----></li><li><a href="/quickstart/idc.html" class="sidebar-item sidebar-heading" aria-label="阶段2 向他人服务"><!--[--><!--]--> 阶段2 向他人服务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/quickstart/multi_location.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="阶段3 多地部署"><!--[--><!--]--> 阶段3 多地部署 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/quickstart/multi_location.html#开始之前" class="router-link-active router-link-exact-active sidebar-item" aria-label="开始之前"><!--[--><!--]--> 开始之前 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/quickstart/multi_location.html#介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/quickstart/multi_location.html#基础概念介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="基础概念介绍"><!--[--><!--]--> 基础概念介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/quickstart/multi_location.html#igp跟ibgp的区别和应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="IGP跟iBGP的区别和应用"><!--[--><!--]--> IGP跟iBGP的区别和应用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/quickstart/multi_location.html#full-mesh" class="router-link-active router-link-exact-active sidebar-item" aria-label="full mesh"><!--[--><!--]--> full mesh <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/quickstart/multi_location.html#igp配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="IGP配置"><!--[--><!--]--> IGP配置 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/quickstart/multi_location.html#ospf" class="router-link-active router-link-exact-active sidebar-item" aria-label="OSPF"><!--[--><!--]--> OSPF <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/quickstart/multi_location.html#babel" class="router-link-active router-link-exact-active sidebar-item" aria-label="Babel"><!--[--><!--]--> Babel <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/quickstart/multi_location.html#ibgp-配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="iBGP 配置"><!--[--><!--]--> iBGP 配置 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/quickstart/multi_location.html#ibgp-full-mesh" class="router-link-active router-link-exact-active sidebar-item" aria-label="iBGP Full mesh"><!--[--><!--]--> iBGP Full mesh <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/quickstart/multi_location.html#ibgp-rr" class="router-link-active router-link-exact-active sidebar-item" aria-label="iBGP RR"><!--[--><!--]--> iBGP RR <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/quickstart/multi_location.html#ibgp-confederation" class="router-link-active router-link-exact-active sidebar-item" aria-label="iBGP Confederation"><!--[--><!--]--> iBGP Confederation <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/quickstart/after.html" class="sidebar-item sidebar-heading" aria-label="/quickstart/after.md"><!--[--><!--]--> /quickstart/after.md <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="阶段2-多地部署" tabindex="-1"><a class="header-anchor" href="#阶段2-多地部署" aria-hidden="true">#</a> 阶段2 多地部署</h1><p>在这篇文章中，我们将讲解多机器时的内网搭建方法和iBGP的配置。</p><h2 id="开始之前" tabindex="-1"><a class="header-anchor" href="#开始之前" aria-hidden="true">#</a> 开始之前</h2><p>我们假设：</p><ul><li><p>你的ASN是 <code>AS114514</code></p></li><li><p>你有七台机器</p><ol><li>10.0.0.1 2404::1 fe80::1 边界节点 广播2404:1::/48</li><li>10.0.0.2 2404::2 fe80::2 内网节点</li><li>10.0.0.3 2404::3 fe80::3 内网节点</li><li>10.0.0.4 2404::4 fe80::4 边界节点 广播2404:2::/48</li><li>10.0.0.5 2404::5 fe80::5 内网节点</li><li>10.0.0.6 2404::6 fe80::6 内网节点</li><li>10.0.0.7 2404::7 fe80::7 边界节点 广播2404:3::/48</li></ol><p>fe80开头的为<code>Link Local IPv6</code></p><p>如下所示，其中黑色直线代表有链路存在，蓝色椭圆代表AS114514这个自治系统</p></li></ul><p><img src="/assets/1.e6a6eff3.png" alt="1"></p><p><strong>该设置将通用于本篇教程</strong></p><h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍" aria-hidden="true">#</a> 介绍</h2><p>经过了一段时间的发展，你现在已经有七个节点，现在你想为他们做一个内网。</p><p>在内网中，我们需要使用IGP跟iBGP协议。</p><h3 id="基础概念介绍" tabindex="-1"><a class="header-anchor" href="#基础概念介绍" aria-hidden="true">#</a> 基础概念介绍</h3><ul><li><p>IGP（全称Interior Gateway Protocol），即在AS<strong>内部</strong>使用的路由协议。用来管理内网路由。</p><p>常见的IGP协议有：<code>OSPF</code>，<code>babel</code>，<code>ISIS</code>。其中我们将主要讲解<code>OSPF</code>。</p></li><li><p>iBGP（全称Interior BGP），是将路由在边界路由器<strong>之间</strong>传递路由的方式，用来管理多地的公网路由。</p></li><li><p>链路，通俗来说，指的是一条二层可达的连接，比如使用网线连接。隧道是一种特殊的链路。</p></li><li><p>Link Local IPv6，缩写<code>LL IPv6</code>或<code>IPv6 LL</code>，用于链路之上的IPv6，仅在同一链路内有效。在本篇文章中，我们使用LL IPv6来简化链路之间的连接。</p></li></ul><h3 id="igp跟ibgp的区别和应用" tabindex="-1"><a class="header-anchor" href="#igp跟ibgp的区别和应用" aria-hidden="true">#</a> IGP跟iBGP的区别和应用</h3><p>当年我看完这两套协议后，十分不解：这两个协议的区别在哪？该如何应用？所以，我们来单独讲一下它们的区别。</p><p>IGP的主要应用在于自治系统内的内网路由的传递。如上图中示例，则IGP是用来管理10.0.0.1-10.0.0.7这一段IP的传递。</p><p>iBGP的主要应用在于自治系统的边界路由器之间外部路由传递。如上图中示例，则iBGP用来在10.0.0.1 10.0.0.4 10.0.0.7之间传递各自的广播段和外部BGP收到的段。</p><h3 id="full-mesh" tabindex="-1"><a class="header-anchor" href="#full-mesh" aria-hidden="true">#</a> full mesh</h3><p>full mesh是一种连接形式，即所有节点之间全部两两直接连接。</p><p>在内网搭建中，有不少人会搞混BGP full mesh与tunnel full mesh。</p><p>iBGP为了防止环路，所以每个路由仅会传递给他的直接邻居，不会传递给邻居的邻居，也就是说边界路由器之间需要两两连接以保证路由可以传递到每一个边界路由器，这就是BGP full mesh。</p><p>而让边界路由器之间能够直接连接，最直接而最简单的方法就是让网络full mesh，也就是tunnel full mesh。但当网络内节点变得多的时候，这种连接方式就会变得费时费力，难以维护，易出错。为了简化连接，我们就需要使用IGP来代替tunnel full mesh并达到full mesh的效果，即网络内所有设备都能联通。</p><h2 id="igp配置" tabindex="-1"><a class="header-anchor" href="#igp配置" aria-hidden="true">#</a> IGP配置</h2><h3 id="ospf" tabindex="-1"><a class="header-anchor" href="#ospf" aria-hidden="true">#</a> OSPF</h3><h3 id="babel" tabindex="-1"><a class="header-anchor" href="#babel" aria-hidden="true">#</a> Babel</h3><h2 id="ibgp-配置" tabindex="-1"><a class="header-anchor" href="#ibgp-配置" aria-hidden="true">#</a> iBGP 配置</h2><h3 id="ibgp-full-mesh" tabindex="-1"><a class="header-anchor" href="#ibgp-full-mesh" aria-hidden="true">#</a> iBGP Full mesh</h3><h3 id="ibgp-rr" tabindex="-1"><a class="header-anchor" href="#ibgp-rr" aria-hidden="true">#</a> iBGP RR</h3><h3 id="ibgp-confederation" tabindex="-1"><a class="header-anchor" href="#ibgp-confederation" aria-hidden="true">#</a> iBGP Confederation</h3></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: pppwaw@pppwaw.top">pppwaw</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/quickstart/idc.html" class="" aria-label="阶段2 向他人服务"><!--[--><!--]--> 阶段2 向他人服务 <!--[--><!--]--></a></span><span class="next"><a href="/quickstart/after.html" class="" aria-label="/quickstart/after.md"><!--[--><!--]--> /quickstart/after.md <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.6747bec2.js" defer></script>
  </body>
</html>
